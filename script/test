#!/usr/bin/env bash
#
# <doc>
#
# Run the test suite.
#
# </doc>


main () {
    local bats
    local tests
    local name
    local path

    bats="${MANAGEDIRECTORY}/vendor/bats/bin/bats"
    tests="${MANAGEDIRECTORY}/test"

    if [ -n "$1" ]
    then
        path="$(cd "${tests}" || exit ; pwd)"
        local OPWD=$PWD ; cd "${path}" || exit
        for file in "${path}"/*
        do
            if [   -f "${file}" ] &&
               [   -r "${file}" ] &&
               [ ! -L "${file}" ] &&
               [[ "$(basename "${file}")" == *.bats ]]
            then
                name="$(basename "${file}")"
                if [[ "$1" == "${name::-5}" ]]
                then
                    "${bats}" --tap "${file}"
                fi
            fi
        done
        cd "${OPWD}" || exit
    else
        "${bats}" --tap "${tests}"
    fi
}

